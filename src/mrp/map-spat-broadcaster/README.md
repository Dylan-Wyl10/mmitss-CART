# MAP-SPAT-BROADCASTER

## Work-flow
work flow

## Console output and logging
Map-Spat-Broadcaster component does not generate any log files. The console output displays if the broadcast of the Map and SPaT messages has started successfully.

## Requirements
- Physical network connection between the host machine (hosting the Map-Spat-Broadcaster) and the target [NTCIP-1202](https://www.ntcip.org/wp-content/uploads/2018/11/NTCIP1202v0219f.pdf) compliant traffic actuated signal controller.
- In case of Econolite signal controller, MapSpatBroadcaster sends an SnmpSetRequest to the MMITSS component Snmp-Engine that enables the streaming of raw SPaT blob from the signal controller. For this feature to function correctly, the MMITSS component Snmp-Engine needs to be running prior to the starting of Map-Spat-Broadcaster.

## Configuration
1. In the signal controller:
- The server IP to which the signal controller streams the raw SPaT blob must be set to the IP address of the host where Map-Spat-Broadcaster is hosted.
- Port where the signal controller streams the raw SPAT blob must match in both, the Map-Spat-Broadcaster configuration and the corresponding configuration in the signal controller.

2. In the mmitss-phase3-master-config.json (config) file, following keys need to be assigned with appropriate values:
- `config["SignalController"]["IpAddress"]`: IPv4 address of the signal controller (string)
- `config["PortNumber"]["MapSPaTBroadcaster"]`:  UDP port number on the host (integer) where the signal controller pushes the raw SPaT blob. Note: Change only if the default (recommended) port number is already occupied on the host machine. In case of a change, corresponding change in the signal controller needs to be ensured. 
- `config["SignalController"]["Vendor"]`: vendor of the signal-controller (string). (tested on Econolite Cobalt, Intellight MaxTime). For Econolite signal controllers, use "Econolite" here.
- `config["signalController"]["InactiveVehPhases"]`
- `config["signalController"]["InactivePedPhases"]`
- `config["signalController"]["SplitPhases"]["1"]`
- `config["SignalController"]["SplitPhases"]["3"]`
- `config["SignalController"]["SplitPhases"]["5"]`
- `config["SignalController"]["SplitPhases"]["7"]`
- `config["SignalController"]["PermissiveEnabled"]["1"]`
- `config["SignalController"]["PermissiveEnabled"]["3"]`
- `config["SignalController"]["PermissiveEnabled"]["5"]`
- `config["SignalController"]["PermissiveEnabled"]["7"]`

3. In the mmitss-data-external-clients.json (clients) file, external network clients that need either the raw spat blob or the SPaT JSON string generated by the Map-Spat-Broadcaster can be specified by adding appropriate values to the following keys:
- `clients["spat"]["blob"]`
- `clients["spat"]["json"]`

## Known issues
some issues
